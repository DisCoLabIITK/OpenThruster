%---------------------- Morgan 1968 camer correction ---------------------
%
% Provides values for the factors Kc, Ka, Kt based on Morgan (1968).
%
% Input:
%   TANBIC - tan(Beta_i) at control points.
%   RC     - radius at control point, normalized by max radius.
%   EAR    - expanded area ratio.
%   Z      - number of blades
%

% %------------------------------------------------------------------------
% load Case4119
% Z        = input.Z;
% RC       = design.RC;
% TANBIC   = design.TANBIC;
% EAR      = 0.6065;

% PLI = 0.4
% RC = 0.3
% EAR = 0.35
% Z=4
% %------------------------------------------------------------------------


function [Kc,Ka,Kt] = Morgan1968(RC,TANBIC,EAR,Z)

PLI=pi*RC.*TANBIC;

% Only extrapolate in Z to Z == 3 or 7
if     Z < 3
    Z = 3;
elseif Z > 7 
    Z = 7;
end

% Do not extrapolate in EAR
if     EAR < .35
   EAR = .35;
elseif EAR > 1.15;
   EAR = 1.15;
end

% Do not extrapolate in PLI: [0.4 , 2.0]
PLI(PLI < 0.4) = 0.4;
PLI(PLI > 2.0) = 2.0;


% -------------------------------------------------------------------------
% --- Morgan camber correction tables ---
%
% Table format:
%    k?3Dtable(pi*lambda_i, r , Ae/Ao, Z)  -- Morgan1968 nomenclature
%
%    k?3Dtable(PLI        , RC,   EAR, Z)  -- OpenProp   nomenclature
%
kc3Dtable = zeros(5,7,5,3);
ka3Dtable = zeros(5,7,5,3);
kt3Dtable = zeros(5,7,5,3);



%--- kc3D table ---

% Set values for Z<=4
kc3Dtable(:,:,1,1)= [1.185 1.016 1.018 1.033 1.097 1.213 1.523;...
                     1.140 1.042 1.055 1.088 1.157 1.255 1.489;...
                     1.178 1.061 1.078 1.117 1.183 1.262 1.513;...
                     1.212 1.091 1.114 1.140 1.187 1.260 1.488;...
                     1.241 1.115 1.118 1.140 1.186 1.267 1.452];

kc3Dtable(:,:,2,1)= [1.335 1.035 1.036 1.090 1.201 1.405 1.978;...
                     1.297 1.099 1.129 1.199 1.312 1.497 1.986;...
                     1.370 1.166 1.190 1.251 1.355 1.517 1.894;...
                     1.439 1.220 1.229 1.281 1.378 1.519 1.891;...
                     1.495 1.265 1.267 1.306 1.385 1.519 1.872];

kc3Dtable(:,:,3,1)= [1.629 1.118 1.066 1.153 1.318 1.640 2.480;...
                     1.540 1.237 1.259 1.338 1.498 1.778 2.389;...
                     1.640 1.330 1.354 1.431 1.573 1.803 2.360;...
                     1.733 1.409 1.411 1.479 1.606 1.814 2.337;...
                     1.803 1.465 1.454 1.511 1.622 1.815 2.317];

kc3Dtable(:,:,4,1)= [2.063 1.391 1.256 1.229 1.444 1.875 2.976;...
                     1.889 1.459 1.462 1.541 1.733 2.078 2.876;...
                     1.983 1.556 1.568 1.657 1.835 2.125 2.831;...
                     2.087 1.642 1.641 1.717 1.873 2.142 2.815;...
                     2.151 1.711 1.591 1.754 1.892 2.140 2.805];

kc3Dtable(:,:,5,1)= [2.571 1.774 1.597 1.535 1.638 2.147 3.469;...
                     2.298 1.756 1.758 1.809 2.016 2.400 3.391;...
                     2.376 1.832 1.844 1.938 2.134 2.470 3.332;...
                     2.473 1.917 1.904 1.991 2.178 2.490 3.315;...
                     2.553 1.984 1.952 2.019 2.192 2.486 3.290];
%---

% Set values for Z=5
kc3Dtable(:,:,1,2)= [1.136 0.985 0.992 1.017 1.042 1.119 1.383;...
                     1.118 1.011 1.038 1.047 1.084 1.173 1.361;...
                     1.161 1.050 1.049 1.066 1.111 1.156 1.300;...
                     1.171 1.062 1.061 1.084 1.127 1.214 1.337;...
                     1.192 1.082 1.079 1.104 1.153 1.205 1.334];

kc3Dtable(:,:,2,2)= [1.269 0.965 0.978 1.021 1.092 1.239 1.720;...
                     1.253 1.054 1.057 1.101 1.187 1.341 1.691;...
                     1.317 1.116 1.124 1.160 1.233 1.367 1.676;...
                     1.373 1.169 1.162 1.193 1.262 1.390 1.655;...
                     1.407 1.203 1.191 1.214 1.294 1.389 1.647];

kc3Dtable(:,:,3,2)= [1.547 1.007 0.964 1.029 1.134 1.375 2.098;...
                     1.490 1.169 1.143 1.185 1.307 1.534 2.062;...
                     1.565 1.257 1.242 1.285 1.392 1.580 2.030;...
                     1.637 1.332 1.308 1.341 1.436 1.599 2.014;...
                     1.687 1.383 1.348 1.377 1.464 1.611 2.021];

kc3Dtable(:,:,4,2)= [1.979 1.251 1.095 1.074 1.167 1.543 2.450;...
                     1.812 1.376 1.309 1.329 1.458 1.749 2.440;...
                     1.878 1.453 1.427 1.467 1.583 1.822 2.420;...
                     1.958 1.540 1.499 1.534 1.544 1.854 2.402;...
                     2.012 2.600 2.553 1.583 1.679 1.868 2.383];

kc3Dtable(:,:,5,2)= [2.442 1.574 1.364 1.253 1.304 1.687 2.839;...
                     2.193 1.644 1.573 1.554 1.670 1.990 2.829;...
                     2.234 1.714 1.668 1.695 1.825 2.102 2.808;...
                     2.311 1.791 1.737 1.769 1.888 2.137 2.808;...
                     2.375 1.855 1.787 1.811 1.920 2.150 2.785];
%---

% Set values for Z>=6
kc3Dtable(:,:,1,3)= [1.194 0.952 0.979 0.953 1.094 1.091 1.277;...     %Table 5 for Z=6, Ae/Ao=0.35, pilambdai=0.4 is very hard to read - partly worn/erased
                     1.101 1.007 1.001 1.013 1.058 1.136 1.275;...
                     1.128 1.024 1.025 1.042 1.078 1.145 1.269;...
                     1.153 1.052 1.086 1.087 1.102 1.142 1.286;...
                     1.184 1.087 1.076 1.084 1.099 1.141 1.249];

kc3Dtable(:,:,2,3)= [1.212 0.918 0.923 0.976 1.038 1.143 1.541;...
                     1.238 1.026 1.022 1.042 1.111 1.243 1.537;...
                     1.296 1.093 1.074 1.099 1.174 1.273 1.527;...
                     1.337 1.140 1.119 1.152 1.198 1.287 1.560;...
                     1.377 1.186 1.159 1.171 1.209 1.294 1.533];

kc3Dtable(:,:,3,3)= [1.474 0.944 0.888 0.938 1.062 1.247 1.864;...
                     1.469 1.129 1.076 1.090 1.190 1.376 1.842;...
                     1.532 1.223 1.176 1.196 1.277 1.430 1.818;...
                     1.587 1.289 1.247 1.262 1.332 1.462 1.810;...
                     1.535 1.343 1.295 1.298 1.355 1.479 1.803];

kc3Dtable(:,:,4,3)= [1.885 1.147 0.969 0.958 1.031 1.333 2.160;...
                     1.771 1.319 1.226 1.200 1.301 1.542 2.141;...
                     1.826 1.411 1.340 1.345 1.430 1.627 2.127;...
                     1.896 1.495 1.422 1.421 1.496 1.670 2.115;...
                     1.942 1.549 1.474 1.471 1.544 1.690 2.119];

kc3Dtable(:,:,5,3)= [2.351 1.447 1.211 1.113 1.140 1.435 2.250;...
                     2.115 1.566 1.449 1.398 1.455 1.727 2.474;...
                     2.165 1.651 1.557 1.543 1.627 1.852 2.453;...
                     2.230 1.726 1.634 1.625 1.708 1.901 2.454;...
                     2.276 1.783 1.689 1.681 1.754 1.926 2.448];

%---

%------------------


%--- kc3D table ---
% Set values for Z=4
ka3Dtable(:,:,1,1)= [1.380 1.182 1.112 1.142 1.180 1.251 1.540;...
                     1.322 1.172 1.171 1.195 1.215 1.286 1.456;...
                     1.266 1.199 1.204 1.210 1.220 1.304 1.360;...
                     1.243 1.190 1.146 1.191 1.251 1.318 1.393;...
                     1.215 1.167 1.187 1.227 1.267 1.300 1.436];

ka3Dtable(:,:,2,1)= [1.715 1.344 1.235 1.247 1.337 1.503 2.038;...
                     1.597 1.403 1.343 1.354 1.442 1.535 1.895;...
                     1.515 1.385 1.384 1.417 1.477 1.589 1.854;...
                     1.466 1.394 1.404 1.454 1.493 1.511 1.854;...
                     1.411 1.353 1.383 1.440 1.514 1.512 1.370];

ka3Dtable(:,:,3,1)= [2.218 1.677 1.399 1.378 1.507 1.781 2.532;...
                     1.961 1.711 1.591 1.589 1.682 1.844 2.356;...
                     1.815 1.691 1.636 1.674 1.749 1.886 2.320;...
                     1.724 1.659 1.655 1.712 1.786 1.923 2.327;...
                     1.662 1.636 1.645 1.715 1.815 1.933 2.337];

ka3Dtable(:,:,4,1)= [2.758 2.197 1.782 1.515 1.687 2.004 3.023;...
                     2.358 2.096 1.921 1.888 1.980 2.168 2.818;...
                     2.150 2.029 1.948 1.980 2.075 2.237 2.770;...
                     2.015 1.958 1.945 2.016 2.118 2.271 2.805;...
                     1.937 1.918 1.928 2.018 2.138 2.298 2.787];

ka3Dtable(:,:,5,1)= [3.314 2.718 2.296 2.112 2.071 2.299 3.500;...
                     2.800 2.533 2.309 2.274 2.353 2.540 3.291;...
                     2.509 2.401 2.289 2.328 2.458 2.613 3.263;...
                     2.333 2.301 2.266 2.342 2.481 2.654 3.278;...
                     2.823 2.228 2.232 2.341 2.498 2.677 3.323];

%---

% Set values for Z=5
ka3Dtable(:,:,1,2)= [1.298 1.096 1.078 1.034 1.101 1.172 1.388;...
                     1.240 1.144 1.052 1.102 1.153 1.199 1.348;...
                     1.146 1.096 1.117 1.145 1.176 1.175 1.229;...
                     1.190 1.141 1.144 1.155 1.183 1.219 1.347;...
                     1.177 1.139 1.140 1.146 1.177 1.220 1.335];

ka3Dtable(:,:,2,2)= [1.555 1.199 1.111 1.129 1.202 1.347 1.783;...
                     1.795 1.549 1.430 1.396 1.458 1.623 2.057;...
                     1.430 1.315 1.253 1.288 1.356 1.421 1.653;...
                     1.375 1.294 1.295 1.326 1.384 1.404 1.658;...
                     1.375 1.311 1.309 1.349 1.337 1.450 1.670];

ka3Dtable(:,:,3,2)= [1.985 1.478 1.220 1.201 1.282 1.525 2.195;...
                     1.795 1.549 1.430 1.396 1.458 1.623 2.057;...
                     1.687 1.556 1.483 1.493 1.556 1.661 2.029;...
                     1.611 1.324 1.505 1.544 1.602 1.684 2.015;...
                     1.592 1.527 1.519 1.554 1.600 1.732 1.998];

ka3Dtable(:,:,4,2)= [2.453 1.899 1.545 1.383 1.409 1.594 2.551;...
                     2.147 1.893 1.706 1.547 1.592 1.865 2.432;...
                     1.983 1.852 1.749 1.749 1.802 1.935 2.419;...
                     1.852 1.801 1.761 1.794 1.857 1.988 2.415;...
                     1.818 1.770 1.758 1.799 1.885 2.008 2.419];

ka3Dtable(:,:,5,2)= [2.940 2.370 1.971 1.801 1.677 1.860 2.976;...
                     2.519 2.263 2.038 1.975 1.992 2.162 2.815;...
                     2.296 2.182 2.046 2.049 2.118 2.241 2.788;...
                     2.161 2.105 2.040 2.075 2.155 2.298 2.788;...
                     2.077 2.049 2.012 2.079 2.180 2.326 2.813];
%---

% Set values for Z>=6
ka3Dtable(:,:,1,3)= [1.215 1.852 1.015 1.045 1.073 1.053 1.314;...     %Table 5 for Z=6, Ae/Ao=0.35, pilambdai=0.4 is very hard to read - partly worn/erased
                     1.203 1.067 1.068 1.079 1.069 1.084 1.273;...
                     1.173 1.112 1.092 1.099 1.115 1.125 1.261;...
                     1.156 1.096 1.084 1.118 1.147 1.169 1.175;...
                     1.103 1.050 1.053 1.078 1.131 1.181 1.243];

ka3Dtable(:,:,2,3)= [1.438 1.117 1.047 1.059 1.135 1.206 1.608;...
                     1.413 1.229 1.147 1.164 1.200 1.250 1.537;...
                     1.358 1.248 1.222 1.223 1.209 1.328 1.529;...
                     1.351 1.262 1.236 1.201 1.265 1.351 1.440;...
                     1.313 1.232 1.223 1.247 1.304 1.361 1.480];

ka3Dtable(:,:,3,3)= [1.831 1.342 1.110 1.094 1.155 1.323 1.923;...
                     1.599 1.452 1.311 1.285 1.318 1.449 1.832;...
                     1.607 1.469 1.394 1.390 1.416 1.530 1.817;...
                     1.576 1.473 1.418 1.412 1.466 1.547 1.833;...
                     1.540 1.447 1.422 1.442 1.511 1.560 1.812];

ka3Dtable(:,:,4,3)= [2.258 1.699 1.389 1.237 1.226 1.422 2.273;...
                     2.012 1.764 1.566 1.487 1.500 1.658 2.164;...
                     1.882 1.739 1.628 1.585 1.635 1.743 2.150;...
                     1.801 1.703 1.639 1.635 1.695 1.766 2.154;...
                     1.775 1.695 1.650 1.672 1.710 1.825 2.185];

ka3Dtable(:,:,5,3)= [2.697 2.110 1.769 1.575 1.460 1.608 2.547;...
                     2.348 2.103 1.869 1.775 1.757 1.892 2.491;...
                     2.169 2.047 1.894 1.853 1.888 1.998 2.303;...
                     2.069 1.983 1.897 1.905 1.942 2.040 2.502;...
                     2.014 1.945 1.890 1.908 1.971 2.100 2.520];
%---
%------------------


%--- kc3D table ---
% Set values for Z=4
kt3Dtable(:,:,1,1)= [.179 .118 .076 .050 .033 .021 .009;...
                     .191 .151 .114 .083 .057 .032 .025;...
                     .157 .154 .131 .102 .074 .051 .040;...
                     .147 .146 .130 .106 .052 .051 .051;...
                     .117 .130 .134 .105 .084 .065 .057];

kt3Dtable(:,:,2,1)= [.417 .235 .127 .072 .048 .032 .004;...
                     .398 .279 .190 .126 .082 .054 .035;...
                     .299 .241 .186 .138 .097 .058 .051;...
                     .229 .209 .177 .140 .105 .077 .062;...
                     .151 .175 .150 .134 .105 .081 .057];

kt3Dtable(:,:,3,1)= [.813 .459 .242 .125 .072 .045 .010;...
                     .531 .370 .253 .165 .105 .067 .045;...
                     .322 .302 .237 .174 .122 .083 .063;...
                     .299 .259 .218 .171 .155 .093 .075;...
                     .222 .215 .193 .150 .125 .095 .079];

kt3Dtable(:,:,4,1)= [.915 .615 .384 .217 .110 .055 .048;...
                     .614 .457 .338 .230 .145 .090 .055;...
                     .417 .347 .275 .206 .147 .101 .075;...
                     .297 .277 .238 .190 .142 .104 .085;...
                     .220 .224 .202 .170 .134 .104 .085];

kt3Dtable(:,:,5,1)= [.975 .737 .521 .334 .182 .091 .034;...
                     .598 .432 .359 .264 .174 .110 .082;...
                     .423 .351 .294 .288 .157 .118 .075;...
                     .305 .289 .252 .205 .156 .115 .093;...
                     .335 .252 .212 .188 .145 .114 .098];
%---

% Set values for Z=5
kt3Dtable(:,:,1,2)= [.290 .174 .102 .061 .040 .025 .007;...
                     .330 .228 .154 .103 .069 .045 .027;...
                     .300 .234 .176 .127 .088 .060 .045;...
                     .264 .229 .181 .127 .072 .024 -.011;...
                     .220 .202 .170 .127 .078 .027 -.021];

kt3Dtable(:,:,2,2)= [.517 .336 .173 .093 .060 .041 -.000;...
                     .615 .411 .265 .165 .104 .066 .041;...
                     .479 .350 .252 .183 .123 .083 .061;...
                     .377 .315 .250 .187 .133 .094 .076;...
                     .305 .272 .228 .179 .134 .098 .081];

kt3Dtable(:,:,3,2)= [1.082 .503 .312 .158 .089 .055 .007;...
                     .783 .540 .357 .225 .137 .084 .058;...
                     .589 .459 .341 .241 .161 .106 .080;...
                     .458 .394 .317 .238 .168 .117 .096;...
                     .352 .322 .273 .216 .162 .119 .097];

kt3Dtable(:,:,4,2)= [1.290 .858 .528 .291 .140 .057 .052;...
                     .907 .682 .484 .320 .195 .115 .087;...
                     .634 .517 .400 .291 .199 .132 .097;...
                     .465 .419 .350 .259 .194 .135 .111;...
                     .357 .344 .298 .241 .183 .136 .110];

kt3Dtable(:,:,5,2)= [1.380 1.031 .718 .452 .247 .113 .063;...
                     .869 .702 .531 .371 .237 .144 .107;...
                     .643 .540 .432 .326 .232 .158 .112;...
                     .477 .441 .376 .296 .218 .156 .127;...
                     .373 .358 .317 .261 .203 .154 .124];
%---

% Set values for Z>=6
kt3Dtable(:,:,1,3)= [  .414 .237 .130 .073 .047 .031 .005;...
                     .485 .314 .198 .125 .081 .054 .027;...
                     .440 .323 .229 .157 .104 .069 .051;...
                     .396 .321 .244 .169 .098 .034 -.020;...
                     .328 .278 .222 .166 .119 .086 .074];

kt3Dtable(:,:,2,3)= [  .838 .448 .223 .115 .074 .050 -.006;...
                     .870 .562 .349 .211 .128 .080 .047;...
                     .584 .497 .348 .234 .152 .100 .073;...
                     .544 .437 .334 .240 .164 .113 .092;...
                     .450 .380 .304 .229 .164 .117 .097];

kt3Dtable(:,:,3,3)= [  1.580 .855 .423 .202 .112 .072 -.002;...
                     1.080 .732 .474 .291 .172 .103 .070;...
                     .827 .531 .458 .315 .205 .131 .098;...
                     .654 .547 .429 .312 .212 .143 .117;...
                     .524 .461 .379 .291 .210 .150 .122];

kt3Dtable(:,:,4,3)= [  1.701 1.122 .583 .372 .175 .080 .074;...
                     1.240 .925 .649 .420 .248 .141 .110;...
                     .883 .711 .542 .387 .259 .155 .120;...
                     .557 .583 .477 .360 .251 .171 .140;...
                     .528 .482 .408 .322 .237 .170 .137];

kt3Dtable(:,:,5,3)= [  1.833 1.353 .931 .582 .314 .139 .069;...
                     1.185 .950 .712 .491 .307 .182 .134;...
                     .890 .744 .590 .440 .305 .202 .140;...
                     .675 .615 .517 .400 .287 .200 .160;...
                     .534 .503 .438 .354 .269 .197 .157];
%---
%------------------
% -------------------------------------------------------------------------


% -------------------------------------------------------------------------
% %--- Define reference vectors ---
% 
PLIref  = [.4 .8 1.2 1.6 2.0];

RCref   = [.3 .4 .5 .6 .7 .8 .9];

EARref  = [.35 .55 .75 .95 1.15];

Zref    = [4 5 6];

[PLIref,RCref,EARref,Zref] = ndgrid(PLIref,RCref,EARref,Zref);
% %--------------------------------

onesRC = RC./RC;

Kc = interpn(PLIref,RCref,EARref,Zref,kc3Dtable,  PLI,RC,EAR*onesRC,Z*onesRC,  'spline');
Ka = interpn(PLIref,RCref,EARref,Zref,ka3Dtable,  PLI,RC,EAR*onesRC,Z*onesRC,  'spline');
Kt = interpn(PLIref,RCref,EARref,Zref,kt3Dtable,  PLI,RC,EAR*onesRC,Z*onesRC,  'spline');


% Kc = 0*RC;
% Ka = 0*RC;
% Kt = 0*RC;
% 
% for i = 1:length(RC)
%     Kc(i) = interpn(PLIref,RCref,EARref,Zref,kc3Dtable,  PLI(i),RC(i),EAR,Z,  'spline');
%     Ka(i) = interpn(PLIref,RCref,EARref,Zref,ka3Dtable,  PLI(i),RC(i),EAR,Z,  'spline');
%     Kt(i) = interpn(PLIref,RCref,EARref,Zref,kt3Dtable,  PLI(i),RC(i),EAR,Z,  'spline');
% end

